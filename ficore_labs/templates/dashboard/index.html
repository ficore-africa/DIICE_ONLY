{% extends "base.html" %}

{% block title %}
{{ trans('dashboard_title', default='Dashboard') | escape }}
{% endblock %}

{% block content %}
<div class="container">
    <!-- Inventory Loss Alert -->
    {% if inventory_loss %}
    <div class="alert alert-danger d-flex align-items-center mb-4" role="alert">
        <i class="bi bi-exclamation-octagon me-2"></i>
        <div>
            <strong>{{ trans('inventory_loss_detected', default='Inventory Loss Detected!') | escape }}</strong>
            {{ trans('inventory_loss_message', default='Your inventory cost exceeds expected margins. Please review your stock and pricing.') | escape }}
        </div>
    </div>
    {% endif %}

    <!-- Tax Prep Mode Alert -->
    {% if tax_prep_mode and stats.profit_only is defined %}
    <div class="alert alert-info d-flex align-items-center mb-4" role="alert">
        <i class="bi bi-cash-coin me-2"></i>
        <div>
            <strong>{{ trans('tax_prep_profit_only', default='Profit Only:') | escape }}</strong>
            {{ stats.profit_only | format_currency }}
            <span class="ms-2">{{ trans('tax_prep_profit_note', default='This is your true profit for tax purposes.') | escape }}</span>
        </div>
    </div>
    {% endif %}

    <!-- Tax Prep Mode Toggle -->
    <div class="mb-4">
        <div class="form-check form-switch">
            <input class="form-check-input" type="checkbox" id="taxPrepToggle" {% if tax_prep_mode %}checked{% endif %}>
            <label class="form-check-label" for="taxPrepToggle">
                <i class="bi bi-calculator me-1"></i>
                {{ trans('tax_prep_mode', default='Tax Prep Mode: Show Profit Only') | escape }}
            </label>
        </div>
        <small class="text-muted">{{ trans('tax_prep_help', default='This helps you avoid over-taxation by showing only true profit, not all inflows.') | escape }}</small>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const toggle = document.getElementById('taxPrepToggle');
        toggle.addEventListener('change', function() {
            if (toggle.checked) {
                window.location.href = window.location.pathname + '?tax_prep=1';
            } else {
                window.location.href = window.location.pathname;
            }
        });
    });
    </script>

    <!-- Debt Tracker Alerts -->
    {% if unpaid_debtors or unpaid_creditors %}
    <div class="alert alert-warning d-flex align-items-center mb-4" role="alert">
        <i class="bi bi-exclamation-triangle me-2"></i>
        <div>
            {% if unpaid_debtors %}
                <strong>{{ trans('debtors_unpaid', default='Unpaid Debts:') | escape }}</strong>
                {{ unpaid_debtors|length }} {{ trans('debtors_people_owe_you', default='people owe you money!') | escape }}
                <a href="{{ url_for('debtors.index') }}" class="btn btn-sm btn-outline-primary ms-2">{{ trans('view_details', default='View Details') | escape }}</a><br>
            {% endif %}
            {% if unpaid_creditors %}
                <strong>{{ trans('creditors_unpaid', default='Unpaid Credits:') | escape }}</strong>
                {{ unpaid_creditors|length }} {{ trans('creditors_you_owe', default='people you owe!') | escape }}
                <a href="{{ url_for('creditors.index') }}" class="btn btn-sm btn-outline-primary ms-2">{{ trans('view_details', default='View Details') | escape }}</a>
            {% endif %}
        </div>
    </div>
    {% endif %}

    <!-- User Streak Card -->
    {% if current_user.is_authenticated %}
    <div class="col-md-3">
        <div class="card border-0 shadow-sm h-100">
            <div class="card-body text-center">
                <div class="text-primary mb-2">
                    <i class="bi bi-fire fa-2x"></i>
                </div>
                <h6 class="card-title">{{ trans('streak_title', default='Streak') | escape }}</h6>
                <p class="card-text">
                    <span class="h5 text-primary">{{ streak | default(0) }}</span><br>
                    <small class="text-muted">{{ trans('streak_days', default='days of clean record keeping!') | escape }}</small>
                    {% if streak is defined and streak >= 3 %}
                    <span class="badge bg-warning text-dark ms-2">{{ trans('streak_reward', default='Keep it up!') | escape }}</span>
                    {% endif %}
                </p>
                <a href="{{ url_for('rewards.index') }}" class="btn btn-outline-primary btn-sm">{{ trans('general_view', default='View') | escape }}</a>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Download Profit Summary Button -->
    <div class="mb-4">
        <a href="{{ url_for('reports.profit_loss') }}?format=pdf" class="btn btn-outline-success">
            <i class="bi bi-file-earmark-arrow-down me-1"></i>
            {{ trans('download_profit_summary', default='Download Profit Summary (PDF)') | escape }}
        </a>
    </div>

    <!-- Business Finance Stats -->
    {% if current_user.is_authenticated %}
    <div class="row g-3 mb-4">
        <div class="col-md-3">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-body text-center">
                    <div class="text-primary mb-2">
                        <i class="bi bi-box-seam fa-2x"></i>
                    </div>
                    <h6 class="card-title">{{ trans('inventory_nav_label', default='Inventory') | escape }}</h6>
                    <p class="card-text">
                        <span class="h5 text-primary">{{ stats.total_inventory | default('?') }}</span><br>
                        <small class="text-muted">{{ stats.total_inventory_cost | format_currency }}</small>
                    </p>
                    <a href="{{ url_for('inventory.index') }}" class="btn btn-outline-primary btn-sm">{{ trans('general_view', default='View') | escape }}</a>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-body text-center">
                    <div class="text-primary mb-2">
                        <i class="bi bi-person-plus-fill fa-2x"></i>
                    </div>
                    <h6 class="card-title">{{ trans('general_debtors', default='Debtors') | escape }}</h6>
                    <p class="card-text">
                        <span class="h5 text-primary">{{ stats.total_debtors }}</span><br>
                        <small class="text-muted">{{ stats.total_debtors_amount | format_currency }}</small>
                    </p>
                    <a href="{{ url_for('debtors.index') }}" class="btn btn-outline-primary btn-sm">{{ trans('general_view', default='View') | escape }}</a>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-body text-center">
                    <div class="text-primary mb-2">
                        <i class="bi bi-person-dash-fill fa-2x"></i>
                    </div>
                    <h6 class="card-title">{{ trans('general_creditors', default='Creditors') | escape }}</h6>
                    <p class="card-text">
                        <span class="h5 text-primary">{{ stats.total_creditors }}</span><br>
                        <small class="text-muted">{{ stats.total_creditors_amount | format_currency }}</small>
                    </p>
                    <a href="{{ url_for('creditors.index') }}" class="btn btn-outline-primary btn-sm">{{ trans('general_view', default='View') | escape }}</a>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-body text-center">
                    <div class="text-primary mb-2">
                        <i class="bi bi-cash-stack fa-2x"></i>
                    </div>
                    <h6 class="card-title">{{ trans('receipts_money_in', default='Income') | escape }}</h6>
                    <p class="card-text">
                        <span class="h5 text-primary">{{ stats.total_receipts }}</span><br>
                        <small class="text-muted">{{ stats.total_receipts_amount | format_currency }}</small>
                    </p>
                    <a href="{{ url_for('receipts.index') }}" class="btn btn-outline-primary btn-sm">{{ trans('general_view', default='View') | escape }}</a>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-body text-center">
                    <div class="text-primary mb-2">
                        <i class="bi bi-wallet2 fa-2x"></i>
                    </div>
                    <h6 class="card-title">{{ trans('payments_money_out', default='Expenses') | escape }}</h6>
                    <p class="card-text">
                        <span class="h5 text-primary">{{ stats.total_payments }}</span><br>
                        <small class="text-muted">{{ stats.total_payments_amount | format_currency }}</small>
                    </p>
                    <a href="{{ url_for('payments.index') }}" class="btn btn-outline-primary btn-sm">{{ trans('general_view', default='View') | escape }}</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Reminder Log -->
    {% if show_daily_log_reminder %}
    <div class="mb-4">
        {{ trans('reminder_log_today', default="Have you recorded todayâ€™s sales or expenses? Keep your records up to date!") | escape }}
        <a href="{{ url_for('business.home') }}" class="btn btn-sm btn-primary ms-2">{{ trans('log_now', default='Log Now') | escape }}</a>
    </div>
    {% endif %}

    <!-- Quick Actions -->
    {% if can_interact %}
    <div class="mb-4">
        <h3>{{ trans('general_quick_actions', default='Quick Actions') | escape }}</h3>
        <div class="d-flex flex-wrap gap-2">
            <a href="{{ url_for('inventory.add') }}" class="btn btn-primary">{{ trans('inventory_add', default='Add Inventory Item') | escape }}</a>
            <a href="{{ url_for('creditors.add') }}" class="btn btn-primary">{{ trans('creditors_create_what_you_owe', default='Create What You Owe') | escape }}</a>
            <a href="{{ url_for('debtors.add') }}" class="btn btn-primary">{{ trans('debtors_create_what_they_owe_you', default='Create What They Owe You') | escape }}</a>
            <a href="{{ url_for('payments.add') }}" class="btn btn-primary">{{ trans('payments_add_money_out', default='Add Money Out') | escape }}</a>
            <a href="{{ url_for('receipts.add') }}" class="btn btn-primary">{{ trans('receipts_add_money_in', default='Add Money In') | escape }}</a>
            {% if current_user.role == 'admin' %}
                <a href="{{ url_for('admin.dashboard') }}" class="btn btn-warning">{{ trans('admin_dashboard', default='Admin Dashboard') | escape }}</a>
            {% endif %}
        </div>
    </div>
    {% endif %}

    <!-- Business Finance Data -->
    <div class="row g-4">
        <div class="col-md-6">
            <div class="card">
                <div class="card-body">
                    <h3>{{ trans('inventory_nav_label', default='Inventory') | escape }}</h3>
                    <small class="text-muted">{{ trans('inventory_dashboard_desc', default='Manage your stock') | escape }}</small>
                    {% if recent_inventory %}
                        <table class="table table-striped mt-3">
                            <thead>
                                <tr>
                                    <th>{{ trans('general_name', default='Name') | escape }}</th>
                                    <th>{{ trans('inventory_cost', default='Cost') | escape }}</th>
                                    <th>{{ trans('inventory_expected_margin', default='Expected Margin') | escape }}</th>
                                    {% if can_interact %}
                                    <th>{{ trans('general_actions', default='Actions') | escape }}</th>
                                    {% endif %}
                                </tr>
                            </thead>
                            <tbody>
                                {% for item in recent_inventory %}
                                    <tr>
                                        <td>{{ item.name | escape }}</td>
                                        <td>{{ item.cost | format_currency }}</td>
                                        <td>{{ item.expected_margin | format_percentage }}</td>
                                        {% if can_interact %}
                                        <td>
                                            <button class="btn btn-secondary btn-sm actions-btn"
                                                    data-bs-toggle="modal"
                                                    data-bs-target="#inventoryActionsModal"
                                                    data-id="{{ item._id }}"
                                                    data-name="{{ item.name }}"
                                                    data-cost="{{ item.cost }}"
                                                    data-expected-margin="{{ item.expected_margin }}"
                                                    data-date="{{ item.created_at | format_date }}">
                                                {{ trans('general_actions', default='Actions') | escape }}
                                            </button>
                                        </td>
                                        {% endif %}
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    {% else %}
                        <p>{{ trans('inventory_no_items', default='No inventory items recorded yet.') | escape }}</p>
                    {% endif %}
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card">
                <div class="card-body">
                    <h3>{{ trans('creditors_what_you_owe', default='What You Owe') | escape }}</h3>
                    <small class="text-muted">{{ trans('creditors_what_you_owe_subtext', default='Track your creditors') | escape }}</small>
                    {% if recent_creditors %}
                        <table class="table table-striped mt-3">
                            <thead>
                                <tr>
                                    <th>{{ trans('general_name', default='Name') | escape }}</th>
                                    <th>{{ trans('general_amount', default='Amount') | escape }}</th>
                                    {% if can_interact %}
                                    <th>{{ trans('general_actions', default='Actions') | escape }}</th>
                                    {% endif %}
                                </tr>
                            </thead>
                            <tbody>
                                {% for creditor in recent_creditors %}
                                    <tr>
                                        <td>{{ creditor.name | escape }}</td>
                                        <td>{{ creditor.amount_owed | format_currency }}</td>
                                        {% if can_interact %}
                                        <td>
                                            <button class="btn btn-secondary btn-sm actions-btn"
                                                    data-bs-toggle="modal"
                                                    data-bs-target="#creditorActionsModal"
                                                    data-id="{{ creditor._id }}"
                                                    data-name="{{ creditor.name }}"
                                                    data-amount="{{ creditor.amount_owed }}"
                                                    data-contact="{{ creditor.contact or '' }}"
                                                    data-date="{{ creditor.created_at | format_date }}"
                                                    data-description="{{ creditor.description or '' }}">
                                                {{ trans('general_actions', default='Actions') | escape }}
                                            </button>
                                        </td>
                                        {% endif %}
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    {% else %}
                        <p>{{ trans('creditors_no_what_you_owe', default='You don\'t owe anyone yet.') | escape }}</p>
                    {% endif %}
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card">
                <div class="card-body">
                    <h3>{{ trans('debtors_what_they_owe_you', default='What They Owe You') | escape }}</h3>
                    <small class="text-muted">{{ trans('debtors_what_they_owe_you_subtext', default='Track your debtors') | escape }}</small>
                    {% if recent_debtors %}
                        <table class="table table-striped mt-3">
                            <thead>
                                <tr>
                                    <th>{{ trans('general_name', default='Name') | escape }}</th>
                                    <th>{{ trans('general_amount', default='Amount') | escape }}</th>
                                    {% if can_interact %}
                                    <th>{{ trans('general_actions', default='Actions') | escape }}</th>
                                    {% endif %}
                                </tr>
                            </thead>
                            <tbody>
                                {% for debtor in recent_debtors %}
                                    <tr>
                                        <td>{{ debtor.name | escape }}</td>
                                        <td>{{ debtor.amount_owed | format_currency }}</td>
                                        {% if can_interact %}
                                        <td>
                                            <button class="btn btn-secondary btn-sm actions-btn"
                                                    data-bs-toggle="modal"
                                                    data-bs-target="#debtorActionsModal"
                                                    data-id="{{ debtor._id }}"
                                                    data-name="{{ debtor.name }}"
                                                    data-amount="{{ debtor.amount_owed }}"
                                                    data-contact="{{ debtor.contact or '' }}"
                                                    data-date="{{ debtor.created_at | format_date }}"
                                                    data-reminders="{{ debtor.get('reminder_count', 0) }}"
                                                    data-description="{{ debtor.description or '' }}">
                                                {{ trans('general_actions', default='Actions') | escape }}
                                            </button>
                                        </td>
                                        {% endif %}
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    {% else %}
                        <p>{{ trans('debtors_no_what_they_owe_you', default='No one owes you yet.') | escape }}</p>
                    {% endif %}
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card">
                <div class="card-body">
                    <h3>{{ trans('payments_money_out', default='Money Out') | escape }}</h3>
                    <small class="text-muted">{{ trans('payments_money_out_subtext', default='Track your expenses and payments') | escape }}</small>
                    {% if recent_payments %}
                        <table class="table table-striped mt-3">
                            <thead>
                                <tr>
                                    <th>{{ trans('payments_recipient', default='Recipient') | escape }}</th>
                                    <th>{{ trans('general_amount', default='Amount') | escape }}</th>
                                    {% if can_interact %}
                                    <th>{{ trans('general_actions', default='Actions') | escape }}</th>
                                    {% endif %}
                                </tr>
                            </thead>
                            <tbody>
                                {% for payment in recent_payments %}
                                    <tr>
                                        <td>{{ payment.recipient | escape }}</td>
                                        <td>{{ payment.amount | format_currency }}</td>
                                        {% if can_interact %}
                                        <td>
                                            <button class="btn btn-secondary btn-sm actions-btn"
                                                    data-bs-toggle="modal"
                                                    data-bs-target="#paymentActionsModal"
                                                    data-id="{{ payment._id }}"
                                                    data-recipient="{{ payment.recipient }}"
                                                    data-amount="{{ payment.amount }}"
                                                    data-date="{{ payment.created_at | format_date }}"
                                                    data-description="{{ payment.description or '' }}">
                                                {{ trans('general_actions', default='Actions') | escape }}
                                            </button>
                                        </td>
                                        {% endif %}
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    {% else %}
                        <p>{{ trans('payments_no_money_out', default='No money out recorded yet.') | escape }}</p>
                    {% endif %}
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card">
                <div class="card-body">
                    <h3>{{ trans('receipts_money_in', default='Money In') | escape }}</h3>
                    <small class="text-muted">{{ trans('receipts_money_in_subtext', default='Track your income and receipts') | escape }}</small>
                    {% if recent_receipts %}
                        <table class="table table-striped mt-3">
                            <thead>
                                <tr>
                                    <th>{{ trans('receipts_payer', default='Payer') | escape }}</th>
                                    <th>{{ trans('general_amount', default='Amount') | escape }}</th>
                                    {% if can_interact %}
                                    <th>{{ trans('general_actions', default='Actions') | escape }}</th>
                                    {% endif %}
                                </tr>
                            </thead>
                            <tbody>
                                {% for receipt in recent_receipts %}
                                    <tr>
                                        <td>{{ receipt.payer | escape }}</td>
                                        <td>{{ receipt.amount | format_currency }}</td>
                                        {% if can_interact %}
                                        <td>
                                            <button class="btn btn-secondary btn-sm actions-btn"
                                                    data-bs-toggle="modal"
                                                    data-bs-target="#receiptActionsModal"
                                                    data-id="{{ receipt._id }}"
                                                    data-payer="{{ receipt.payer }}"
                                                    data-amount="{{ receipt.amount }}"
                                                    data-date="{{ receipt.created_at | format_date }}"
                                                    data-description="{{ receipt.description or '' }}">
                                                {{ trans('general_actions', default='Actions') | escape }}
                                            </button>
                                        </td>
                                        {% endif %}
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    {% else %}
                        <p>{{ trans('receipts_no_money_in', default='No money in recorded yet.') | escape }}</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    {% else %}
    <div class="text-center py-5">
        <h3>{{ trans('dashboard_welcome_to_ficore', default='Welcome to Business Finance') | escape }}</h3>
        <p class="text-muted">{{ trans('dashboard_please_login', default='Please log in to view your dashboard.') | escape }}</p>
        <a href="{{ url_for('users.login') }}" class="btn btn-primary">{{ trans('general_login', default='Log In') | escape }}</a>
    </div>
    {% endif %}

    <!-- Inventory Actions Modal -->
    <div class="modal fade" id="inventoryActionsModal" tabindex="-1" aria-labelledby="inventoryActionsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="inventoryActionsModalLabel">{{ trans('inventory_nav_label', default='Inventory') | escape }}</h5>
                    <button class="btn-close" data-bs-dismiss="modal" aria-label="{{ trans('general_close', default='Close') | escape }}"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <p><strong>{{ trans('general_name', default='Name') | escape }}:</strong> <span id="inventoryModalName"></span></p>
                            <p><strong>{{ trans('inventory_cost', default='Cost') | escape }}:</strong> <span id="inventoryModalCost"></span></p>
                        </div>
                        <div class="col-md-6">
                            <p><strong>{{ trans('inventory_expected_margin', default='Expected Margin') | escape }}:</strong> <span id="inventoryModalExpectedMargin"></span></p>
                            <p><strong>{{ trans('general_date', default='Date') | escape }}:</strong> <span id="inventoryModalDate"></span></p>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <a id="inventoryViewBtn" class="btn btn-info" href="#">{{ trans('general_view', default='View') | escape }}</a>
                    {% if can_interact %}
                    <a id="inventoryEditBtn" class="btn btn-primary" href="#">{{ trans('general_edit', default='Edit') | escape }}</a>
                    <form id="inventoryDeleteForm" action="#" method="POST" style="display:inline;">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                        <button type="submit" class="btn btn-danger" onclick="return confirm('{{ trans('general_confirm_delete', default='Are you sure?') | escape | replace('\'', '&#39;') }}')">
                            {{ trans('general_delete', default='Delete') | escape }}
                        </button>
                    </form>
                    {% endif %}
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">{{ trans('general_close', default='Close') | escape }}</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Creditor Actions Modal -->
    <div class="modal fade" id="creditorActionsModal" tabindex="-1" aria-labelledby="creditorActionsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="creditorActionsModalLabel">{{ trans('creditors_what_you_owe', default='What You Owe') | escape }}</h5>
                    <button class="btn-close" data-bs-dismiss="modal" aria-label="{{ trans('general_close', default='Close') | escape }}"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <p><strong>{{ trans('general_name', default='Name') | escape }}:</strong> <span id="creditorModalName"></span></p>
                            <p><strong>{{ trans('general_amount', default='Amount') | escape }}:</strong> <span id="creditorModalAmount"></span></p>
                            <p><strong>{{ trans('general_contact', default='Contact') | escape }}:</strong> <span id="creditorModalContact"></span></p>
                        </div>
                        <div class="col-md-6">
                            <p><strong>{{ trans('general_description', default='Description') | escape }}:</strong> <span id="creditorModalDescription"></span></p>
                            <p><strong>{{ trans('general_date', default='Date') | escape }}:</strong> <span id="creditorModalDate"></span></p>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <a id="creditorViewBtn" class="btn btn-info" href="#">{{ trans('general_view', default='View') | escape }}</a>
                    {% if can_interact %}
                    <a id="creditorEditBtn" class="btn btn-primary" href="#">{{ trans('general_edit', default='Edit') | escape }}</a>
                    <form id="creditorDeleteForm" action="#" method="POST" style="display:inline;">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                        <button type="submit" class="btn btn-danger" onclick='return confirm("{{ trans('general_confirm_delete', default='Are you sure?') | escape }}")'>
                            {{ trans('general_delete', default='Delete') | escape }}
                        </button>
                    </form>
                    {% endif %}
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">{{ trans('general_close', default='Close') | escape }}</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Debtor Actions Modal -->
    <div class="modal fade" id="debtorActionsModal" tabindex="-1" aria-labelledby="debtorActionsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="debtorActionsModalLabel">{{ trans('debtors_what_they_owe_you', default='What They Owe You') | escape }}</h5>
                    <button class="btn-close" data-bs-dismiss="modal" aria-label="{{ trans('general_close', default='Close') | escape }}"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <p><strong>{{ trans('general_name', default='Name') | escape }}:</strong> <span id="debtorModalName"></span></p>
                            <p><strong>{{ trans('general_amount', default='Amount') | escape }}:</strong> <span id="debtorModalAmount"></span></p>
                            <p><strong>{{ trans('general_contact', default='Contact') | escape }}:</strong> <span id="debtorModalContact"></span></p>
                        </div>
                        <div class="col-md-6">
                            <p><strong>{{ trans('general_description', default='Description') | escape }}:</strong> <span id="debtorModalDescription"></span></p>
                            <p><strong>{{ trans('general_date', default='Date') | escape }}:</strong> <span id="debtorModalDate"></span></p>
                            <p><strong>{{ trans('debtors_reminders', default='Reminders') | escape }}:</strong> <span id="debtorModalReminders"></span></p>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <a id="debtorViewBtn" class="btn btn-info" href="#">{{ trans('general_view', default='View') | escape }}</a>
                    {% if can_interact %}
                    <a id="debtorEditBtn" class="btn btn-primary" href="#">{{ trans('general_edit', default='Edit') | escape }}</a>
                    <form id="debtorDeleteForm" action="#" method="POST" style="display:inline;">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                        <button type="submit" class="btn btn-danger" onclick="return confirm('{{ trans('general_confirm_delete', default='Are you sure?') | escape | replace('\'', '&#39;') }}')">
                            {{ trans('general_delete', default='Delete') | escape }}
                        </button>
                    </form>
                    {% endif %}
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">{{ trans('general_close', default='Close') | escape }}</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Payment Actions Modal -->
    <div class="modal fade" id="paymentActionsModal" tabindex="-1" aria-labelledby="paymentActionsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="paymentActionsModalLabel">{{ trans('payments_money_out', default='Money Out') | escape }}</h5>
                    <button class="btn-close" data-bs-dismiss="modal" aria-label="{{ trans('general_close', default='Close') | escape }}"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <p><strong>{{ trans('payments_recipient', default='Recipient') | escape }}:</strong> <span id="paymentModalRecipient"></span></p>
                            <p><strong>{{ trans('general_amount', default='Amount') | escape }}:</strong> <span id="paymentModalAmount"></span></p>
                        </div>
                        <div class="col-md-6">
                            <p><strong>{{ trans('general_description', default='Description') | escape }}:</strong> <span id="paymentModalDescription"></span></p>
                            <p><strong>{{ trans('general_date', default='Date') | escape }}:</strong> <span id="paymentModalDate"></span></p>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <a id="paymentViewBtn" class="btn btn-info" href="#">{{ trans('general_view', default='View') | escape }}</a>
                    {% if can_interact %}
                    <a id="paymentEditBtn" class="btn btn-primary" href="#">{{ trans('general_edit', default='Edit') | escape }}</a>
                    <form id="paymentDeleteForm" action="#" method="POST" style="display:inline;">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                        <button type="submit" class="btn btn-danger" onclick="return confirm('{{ trans('general_confirm_delete', default='Are you sure?') | escape | replace('\'', '&#39;') }}')">
                            {{ trans('general_delete', default='Delete') | escape }}
                        </button>
                    </form>
                    {% endif %}
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">{{ trans('general_close', default='Close') | escape }}</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Receipt Actions Modal -->
    <div class="modal fade" id="receiptActionsModal" tabindex="-1" aria-labelledby="receiptActionsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="receiptActionsModalLabel">{{ trans('receipts_money_in', default='Money In') | escape }}</h5>
                    <button class="btn-close" data-bs-dismiss="modal" aria-label="{{ trans('general_close', default='Close') | escape }}"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <p><strong>{{ trans('receipts_payer', default='Payer') | escape }}:</strong> <span id="receiptModalPayer"></span></p>
                            <p><strong>{{ trans('general_amount', default='Amount') | escape }}:</strong> <span id="receiptModalAmount"></span></p>
                        </div>
                        <div class="col-md-6">
                            <p><strong>{{ trans('general_description', default='Description') | escape }}:</strong> <span id="receiptModalDescription"></span></p>
                            <p><strong>{{ trans('general_date', default='Date') | escape }}:</strong> <span id="receiptModalDate"></span></p>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <a id="receiptViewBtn" class="btn btn-info" href="#">{{ trans('general_view', default='View') | escape }}</a>
                    {% if can_interact %}
                    <a id="receiptEditBtn" class="btn btn-primary" href="#">{{ trans('general_edit', default='Edit') | escape }}</a>
                    <form id="receiptDeleteForm" action="#" method="POST" style="display:inline;">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                        <button type="submit" class="btn btn-danger" onclick="return confirm('{{ trans('general_confirm_delete', default='Are you sure?') | escape | replace('\'', '&#39;') }}')">
                            {{ trans('general_delete', default='Delete') | escape }}
                        </button>
                    </form>
                    {% endif %}
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">{{ trans('general_close', default='Close') | escape }}</button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // JavaScript to handle modal data population
    document.addEventListener('DOMContentLoaded', function () {
        const modals = [
            {
                id: 'inventoryActionsModal',
                fields: ['Name', 'Cost', 'ExpectedMargin', 'Date'],
                viewBtnId: 'inventoryViewBtn',
                editBtnId: 'inventoryEditBtn',
                deleteFormId: 'inventoryDeleteForm'
            },
            {
                id: 'creditorActionsModal',
                fields: ['Name', 'Amount', 'Contact', 'Description', 'Date'],
                viewBtnId: 'creditorViewBtn',
                editBtnId: 'creditorEditBtn',
                deleteFormId: 'creditorDeleteForm'
            },
            {
                id: 'debtorActionsModal',
                fields: ['Name', 'Amount', 'Contact', 'Description', 'Date', 'Reminders'],
                viewBtnId: 'debtorViewBtn',
                editBtnId: 'debtorEditBtn',
                deleteFormId: 'debtorDeleteForm'
            },
            {
                id: 'paymentActionsModal',
                fields: ['Recipient', 'Amount', 'Description', 'Date'],
                viewBtnId: 'paymentViewBtn',
                editBtnId: 'paymentEditBtn',
                deleteFormId: 'paymentDeleteForm'
            },
            {
                id: 'receiptActionsModal',
                fields: ['Payer', 'Amount', 'Description', 'Date'],
                viewBtnId: 'receiptViewBtn',
                editBtnId: 'receiptEditBtn',
                deleteFormId: 'receiptDeleteForm'
            }
        ];

        modals.forEach(modal => {
            const modalElement = document.getElementById(modal.id);
            modalElement.addEventListener('show.bs.modal', function (event) {
                const button = event.relatedTarget;
                const id = button.getAttribute('data-id');
                modal.fields.forEach(field => {
                    const fieldKey = field.toLowerCase().replace('expectedmargin', 'expected-margin');
                    const element = document.getElementById(`${modal.id.replace('ActionsModal', 'Modal')}${field}`);
                    if (element) {
                        element.textContent = button.getAttribute(`data-${fieldKey}`) || 'N/A';
                    }
                });
                const viewBtn = document.getElementById(modal.viewBtnId);
                const editBtn = document.getElementById(modal.editBtnId);
                const deleteForm = document.getElementById(modal.deleteFormId);
                const blueprint = modal.id.toLowerCase().includes('inventory') ? 'inventory' :
                                 modal.id.toLowerCase().includes('creditor') ? 'creditors' :
                                 modal.id.toLowerCase().includes('debtor') ? 'debtors' :
                                 modal.id.toLowerCase().includes('payment') ? 'payments' :
                                 'receipts';
                if (viewBtn) {
                    viewBtn.href = `/${blueprint}/view_page/${id}`;
                }
                if (editBtn) {
                    editBtn.href = `/${blueprint}/edit/${id}`;
                }
                if (deleteForm) {
                    deleteForm.action = `/${blueprint}/delete/${id}`;
                }
            });
        });

        // Enable Bootstrap tooltips
        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
        tooltipTriggerList.forEach(function (tooltipTriggerEl) {
            new bootstrap.Tooltip(tooltipTriggerEl);
        });
    });
</script>
{% endblock %}
